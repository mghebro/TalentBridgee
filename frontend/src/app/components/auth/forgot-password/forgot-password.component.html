<div class="auth-card">
  <ng-container *ngIf="!linkSentTo; else successView">
    <h2>Forgot Password</h2>
    <p class="subtitle">
      Enter the email associated with your account and we will send you a password reset link.
    </p>
    <form nz-form [formGroup]="form" (ngSubmit)="submit()">
      <nz-form-item>
        <nz-form-control
          [nzValidateStatus]="emailControl?.invalid && emailControl?.touched ? 'error' : ''"
          [nzErrorTip]="emailErrorTpl"
        >
          <nz-input-group nzPrefixIcon="mail">
            <input nz-input placeholder="Email address" formControlName="email" type="email" />
          </nz-input-group>
        </nz-form-control>
        <ng-template #emailErrorTpl>
          <span *ngIf="emailControl?.errors?.['required']">Email is required.</span>
          <span *ngIf="emailControl?.errors?.['pattern']">
            Enter a valid email using letters, numbers, and allowed symbols.
          </span>
        </ng-template>
      </nz-form-item>

      <button nz-button nzType="primary" nzBlock [disabled]="form.invalid" [nzLoading]="isLoading">
        Send reset link
      </button>
    </form>
  </ng-container>

  <ng-template #successView>
    <nz-result
      nzStatus="success"
      nzTitle="Reset link sent"
      [nzSubTitle]="'We emailed ' + linkSentTo + '. Follow the link to create a new password.'"
    >
      <div nz-result-extra>
        <button nz-button nzType="primary" nzBlock (click)="resend()" [nzLoading]="isLoading">
          Resend link
        </button>
        <a nz-button nzBlock routerLink="/auth/login">Back to login</a>
      </div>
    </nz-result>
  </ng-template>
</div>
