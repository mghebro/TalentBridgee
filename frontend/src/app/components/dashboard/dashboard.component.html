<div class="dashboard-container">
  <div *ngIf="isLoading" class="loading-container">
    <nz-spin nzSimple [nzSize]="'large'"></nz-spin>
  </div>

  <div *ngIf="!isLoading" class="dashboard-content">
    <div class="welcome-section">
      <div class="welcome-text">
        <h1>Welcome back, {{ currentUser?.firstName }}!</h1>
        <p *ngIf="isUser">Track your job applications and test progress</p>
        <p *ngIf="isOrganization">Manage your vacancies and review applications</p>
      </div>
      <div class="quick-actions">
        <a *ngIf="isUser" routerLink="/vacancies" nz-button nzType="primary">
          <span nz-icon nzType="search"></span> Browse Jobs
        </a>
        <a *ngIf="isOrganization" routerLink="/vacancy-management" nz-button nzType="primary">
          <span nz-icon nzType="plus"></span> Post New Vacancy
        </a>
      </div>
    </div>

    <ng-container *ngIf="isUser">
      <div class="stats-grid">
        <nz-card class="stat-card">
          <div class="stat-icon blue">
            <span nz-icon nzType="file-text" nzTheme="outline"></span>
          </div>
          <nz-statistic [nzValue]="stats.totalApplications || 0" nzTitle="Total Applications">
          </nz-statistic>
        </nz-card>

        <nz-card class="stat-card">
          <div class="stat-icon orange">
            <span nz-icon nzType="clock-circle" nzTheme="outline"></span>
          </div>
          <nz-statistic [nzValue]="stats.pendingApplications || 0" nzTitle="Pending Review">
          </nz-statistic>
        </nz-card>

        <nz-card class="stat-card">
          <div class="stat-icon green">
            <span nz-icon nzType="check-circle" nzTheme="outline"></span>
          </div>
          <nz-statistic [nzValue]="stats.acceptedApplications || 0" nzTitle="Accepted">
          </nz-statistic>
        </nz-card>

        <nz-card class="stat-card">
          <div class="stat-icon purple">
            <span nz-icon nzType="form" nzTheme="outline"></span>
          </div>
          <nz-statistic [nzValue]="stats.testsCompleted || 0" nzTitle="Tests Completed">
          </nz-statistic>
        </nz-card>
      </div>

      <nz-card class="section-card" nzTitle="Recent Applications">
        <ng-template #extra>
          <a routerLink="/my-applications">View All</a>
        </ng-template>

        <div *ngIf="recentActivities.length === 0" class="empty-state">
          <nz-empty nzNotFoundContent="No applications yet">
            <ng-template #nzNotFoundFooter>
              <a routerLink="/vacancies" nz-button nzType="primary">Start Applying</a>
            </ng-template>
          </nz-empty>
        </div>

        <div class="activity-list" *ngIf="recentActivities.length > 0">
          <div class="activity-item" *ngFor="let activity of recentActivities">
            <div class="activity-icon">
              <span nz-icon nzType="file-text" nzTheme="outline"></span>
            </div>
            <div class="activity-content">
              <h4>{{ activity.title }}</h4>
              <p>{{ activity.description }}</p>
              <span class="activity-date">{{ activity.date | date : 'MMM d, yyyy' }}</span>
            </div>
            <nz-tag [nzColor]="getStatusColor(activity.status || '')">{{ activity.status }}</nz-tag>
          </div>
        </div>
      </nz-card>
    </ng-container>

    <ng-container *ngIf="isOrganization">
      <div class="stats-grid">
        <nz-card class="stat-card">
          <div class="stat-icon blue">
            <span nz-icon nzType="solution" nzTheme="outline"></span>
          </div>
          <nz-statistic [nzValue]="stats.totalVacancies || 0" nzTitle="Total Vacancies">
          </nz-statistic>
        </nz-card>

        <nz-card class="stat-card">
          <div class="stat-icon green">
            <span nz-icon nzType="check-circle" nzTheme="outline"></span>
          </div>
          <nz-statistic [nzValue]="stats.activeVacancies || 0" nzTitle="Active Vacancies">
          </nz-statistic>
        </nz-card>

        <nz-card class="stat-card">
          <div class="stat-icon orange">
            <span nz-icon nzType="team" nzTheme="outline"></span>
          </div>
          <nz-statistic [nzValue]="stats.totalReceived || 0" nzTitle="Applications Received">
          </nz-statistic>
        </nz-card>

        <nz-card class="stat-card">
          <div class="stat-icon purple">
            <span nz-icon nzType="user-add" nzTheme="outline"></span>
          </div>
          <nz-statistic [nzValue]="stats.hired || 0" nzTitle="Candidates Hired"> </nz-statistic>
        </nz-card>
      </div>

      <div class="stats-grid secondary">
        <nz-card class="stat-card mini">
          <nz-statistic
            [nzValue]="stats.pendingReview || 0"
            nzTitle="Pending Review"
            [nzValueStyle]="{ color: '#f59e0b' }"
          >
          </nz-statistic>
        </nz-card>

        <nz-card class="stat-card mini">
          <nz-statistic
            [nzValue]="stats.shortlisted || 0"
            nzTitle="Shortlisted"
            [nzValueStyle]="{ color: '#06b6d4' }"
          >
          </nz-statistic>
        </nz-card>
      </div>

      <div class="dashboard-grid">
        <nz-card class="section-card" nzTitle="Recent Applications">
          <ng-template #extra>
            <a routerLink="/applications">View All</a>
          </ng-template>

          <div *ngIf="recentApplications.length === 0" class="empty-state">
            <nz-empty nzNotFoundContent="No applications yet"></nz-empty>
          </div>

          <nz-table
            *ngIf="recentApplications.length > 0"
            #applicationTable
            [nzData]="recentApplications"
            [nzShowPagination]="false"
            nzSize="small"
          >
            <thead>
              <tr>
                <th>Applicant</th>
                <th>Vacancy</th>
                <th>Status</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let app of applicationTable.data">
                <td>
                  <a
                    *ngIf="app.userId"
                    [routerLink]="['/profile', app.userId]"
                    style="color: #1890ff; cursor: pointer"
                  >
                    {{ (app.userFirstName || '') + ' ' + (app.userLastName || '') || 'Applicant' }}
                  </a>
                  <span *ngIf="!app.userId">{{
                    (app.userFirstName || '') + ' ' + (app.userLastName || '') || 'Applicant'
                  }}</span>
                </td>
                <td>{{ app.vacancyTitle }}</td>
                <td>
                  <nz-tag [nzColor]="getStatusColor(app.status)">{{ app.status }}</nz-tag>
                </td>
              </tr>
            </tbody>
          </nz-table>
        </nz-card>

        <nz-card class="section-card" nzTitle="Top Vacancies">
          <ng-template #extra>
            <a routerLink="/vacancy-management">Manage</a>
          </ng-template>

          <div *ngIf="topVacancies.length === 0" class="empty-state">
            <nz-empty nzNotFoundContent="No vacancies yet">
              <ng-template #nzNotFoundFooter>
                <a routerLink="/vacancy-management" nz-button nzType="primary">Create Vacancy</a>
              </ng-template>
            </nz-empty>
          </div>

          <div class="vacancy-list" *ngIf="topVacancies.length > 0">
            <div class="vacancy-item" *ngFor="let vacancy of topVacancies">
              <div class="vacancy-info">
                <h4>{{ vacancy.title }}</h4>
                <span class="meta">{{ vacancy.applicationCount || 0 }} applications</span>
              </div>
              <nz-tag [nzColor]="getStatusColor(vacancy.status)">{{ vacancy.status }}</nz-tag>
            </div>
          </div>
        </nz-card>
      </div>
    </ng-container>
  </div>
</div>
